# 🚀 자동매매 기능 사용 가이드

## 📋 추가된 기능 목록

### 1. 거래 내역 조회 (`/trades`)
최근 거래 내역을 조회하고 상세 정보를 확인할 수 있습니다.

**사용 방법:**
```
/trades
```

**제공 정보:**
- 거래 유형 (매수/매도)
- 거래 ID
- 거래 가격
- 거래 수량
- 총 거래 금액
- 거래 시간
- 거래 상태

**인라인 버튼:**
- 🔄 새로고침 - 최신 거래 내역으로 업데이트
- 📊 더보기 - 추가 거래 내역 보기
- 💰 수익률 - 수익률 페이지로 이동
- 🏠 메인 - 메인 메뉴로 이동

---

### 2. 수익률 확인 (`/profit`)
전체 수익률, 실현/미실현 손익, 거래 통계를 확인할 수 있습니다.

**사용 방법:**
```
/profit
```

**제공 정보:**
- 투자금 및 평가액
- 실현 손익
- 미실현 손익
- 총 수익 금액 및 수익률
- 총 거래 횟수
- 성공/실패 거래 수
- 승률

**인라인 버튼:**
- 📊 거래내역 - 거래 내역 페이지로 이동
- 📈 상세분석 - 상세 분석 보기 (준비 중)
- ⚙️ 설정 - 설정 페이지로 이동
- 🏠 메인 - 메인 메뉴로 이동

---

### 3. 시스템 상태 확인 (`/status`)
현재 시스템 상태, 거래 활성화 여부, 연결 상태를 확인할 수 있습니다.

**사용 방법:**
```
/status
```

**제공 정보:**
- 거래 시스템 상태 (활성/정지)
- 현재 전략
- 시스템 가동 시간
- API 연결 상태
- 마지막 업데이트 시간
- 활성 포지션 수
- 대기 중인 주문 수
- 금일 거래 횟수
- 오류 횟수

**인라인 버튼:**
- ⏸️ 거래중지 / ▶️ 거래시작 - 거래 상태 토글
- 🔄 새로고침 - 상태 업데이트
- ⚙️ 설정 - 설정 페이지로 이동
- 🏠 메인 - 메인 메뉴로 이동

---

### 4. 설정 변경 (`/settings`)
시스템 설정을 조회하고 변경할 수 있습니다.

**사용 방법:**
```
/settings
```

**제공 정보:**
- 자동매매 활성화 상태
- 최대 포지션 크기
- 손절 설정
- 익절 설정
- 일일 손실 한도
- 알림 설정 (전체/거래/수익/리스크)

**인라인 버튼:**
- 🎯 전략설정 - 전략 파라미터 조정 (준비 중)
- ⚠️ 리스크 - 리스크 관리 설정 (준비 중)
- 🔔 알림 - 알림 설정 변경 (준비 중)
- 🔐 보안 - 보안 설정 (준비 중)
- 💾 저장 - 설정 저장 (준비 중)
- 🏠 메인 - 메인 메뉴로 이동

---

### 5. 거래 중지 (`/stop`, `/stop_trading`)
자동매매를 안전하게 중지합니다.

**사용 방법:**
```
/stop
또는
/stop_trading
```

**동작:**
1. 거래 중지 확인 메시지 표시
2. 주의사항 안내
3. 확인 버튼 클릭 시 거래 중지
4. 진행 중인 주문은 완료됨
5. 새로운 거래는 실행되지 않음

---

### 6. 거래 시작 (`/start_trading`)
자동매매를 시작합니다.

**사용 방법:**
```
/start_trading
```

**동작:**
1. 거래 시작 전 확인사항 체크
   - API 연결 상태
   - 계좌 잔액
   - 전략 설정
   - 리스크 관리 설정
2. 확인 버튼 클릭 시 거래 시작
3. 설정된 전략에 따라 자동 거래 실행

---

## 🎮 인라인 키보드 사용법

### 메인 메뉴 (/start)
```
📊 거래내역 | 💰 수익률
🖥️ 상태    | ⚙️ 설정
      ❓ 도움말
```

### 콜백 데이터
- `show_trades` - 거래 내역 표시
- `show_profit` - 수익률 표시
- `show_status` - 상태 표시
- `show_settings` - 설정 표시
- `show_help` - 도움말 표시
- `start_trading` - 거래 시작
- `stop_trading` - 거래 중지
- `main_menu` - 메인 메뉴로 이동

---

## 📊 모의 데이터 시스템

현재 봇은 **모의 데이터**를 사용합니다:

### MockTradingData 클래스
```python
# 거래 내역
get_recent_trades(limit=5)

# 수익률 데이터
get_profit_data()

# 시스템 상태
get_system_status()

# 설정 데이터
get_settings()
```

### 실제 데이터 연동 방법
1. `trading_handlers.py`에서 `MockTradingData` 호출 부분을 실제 API 호출로 교체
2. 데이터베이스 또는 거래 시스템 API와 연동
3. 실시간 데이터 업데이트 구현

---

## 🧪 테스트 시나리오

### 시나리오 1: 거래 내역 조회
```
1. /trades 입력
2. 최근 5개 거래 내역 확인
3. "🔄 새로고침" 버튼 클릭
4. 업데이트된 내역 확인
```

### 시나리오 2: 수익률 확인
```
1. /profit 입력
2. 수익률 정보 확인
3. "📊 거래내역" 버튼 클릭
4. 거래 내역 페이지로 이동 확인
```

### 시나리오 3: 거래 제어
```
1. /status 입력
2. 현재 거래 상태 확인
3. "⏸️ 거래중지" 버튼 클릭
4. 확인 메시지 확인
5. "✅ 확인 - 중지" 버튼 클릭
6. 거래 중지 완료 메시지 확인
7. /start_trading 입력
8. "✅ 확인 - 시작" 버튼 클릭
9. 거래 시작 완료 메시지 확인
```

### 시나리오 4: 설정 확인
```
1. /settings 입력
2. 현재 설정 확인
3. 각 설정 버튼 클릭하여 준비 중 메시지 확인
```

### 시나리오 5: 메인 메뉴 네비게이션
```
1. /start 입력
2. 메인 메뉴 키보드 확인
3. "📊 거래내역" 버튼 클릭
4. 거래 내역 확인
5. "🏠 메인" 버튼 클릭
6. 메인 메뉴로 돌아가기 확인
```

---

## 🎯 실행 방법

### 1. 봇 시작
```powershell
# 환경 변수 설정
$env:TELEGRAM_BOT_TOKEN='your_bot_token_here'

# 봇 실행
python main.py
```

### 2. 텔레그램에서 테스트
1. `@gilbert_ai_bot` 검색
2. `/start` 입력
3. 인라인 버튼 또는 명령어로 기능 테스트

---

## 📝 주요 명령어 목록

| 명령어 | 설명 | 상태 |
|--------|------|------|
| `/start` | 봇 시작 및 메인 메뉴 | ✅ 완료 |
| `/help` | 도움말 표시 | ✅ 완료 |
| `/trades` | 거래 내역 조회 | ✅ 완료 |
| `/profit` | 수익률 확인 | ✅ 완료 |
| `/status` | 시스템 상태 | ✅ 완료 |
| `/settings` | 설정 변경 | ✅ 완료 |
| `/stop` | 거래 중지 | ✅ 완료 |
| `/stop_trading` | 거래 중지 | ✅ 완료 |
| `/start_trading` | 거래 시작 | ✅ 완료 |

---

## 🔧 커스터마이징

### 메시지 스타일 변경
`trading_handlers.py`에서 각 핸들러의 메시지 포맷 수정:
```python
async def trades_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    message = "📊 *최근 거래 내역*\n"  # 여기를 수정
    # ...
```

### 버튼 레이아웃 변경
인라인 키보드 구성 수정:
```python
keyboard = [
    [Button1, Button2],  # 첫 번째 행
    [Button3, Button4],  # 두 번째 행
]
```

### 데이터 소스 변경
`MockTradingData` 클래스를 실제 데이터 소스로 교체:
```python
# 실제 API 호출 예시
async def get_real_trades():
    response = await api_client.get_trades()
    return response.data
```

---

## 🚨 문제 해결

### 문제 1: 버튼이 작동하지 않음
**원인:** 콜백 핸들러 미등록  
**해결:** bot_initializer.py에서 CallbackQueryHandler 등록 확인

### 문제 2: 명령어가 응답하지 않음
**원인:** 핸들러 임포트 오류  
**해결:** bot_initializer.py에서 핸들러 임포트 확인

### 문제 3: 한글이 깨짐
**원인:** 인코딩 문제  
**해결:** encoding_utils.py 사용 확인

---

## 📚 다음 단계

1. **실제 거래 시스템 연동**
   - 업비트 API 연결
   - 실시간 데이터 수신
   - 주문 실행 기능

2. **고급 기능 추가**
   - 차트 생성 및 전송
   - 상세 분석 리포트
   - 포지션 관리

3. **알림 시스템 구현**
   - 실시간 거래 알림
   - 수익률 알림
   - 리스크 경고

4. **보안 강화**
   - 사용자 인증
   - 권한 관리
   - 2단계 인증

---

## 💡 팁

- 모든 기능을 테스트한 후 실제 자금 사용
- 리스크 관리 설정을 항상 확인
- 정기적으로 로그 확인
- 봇 업데이트 시 설정 백업


