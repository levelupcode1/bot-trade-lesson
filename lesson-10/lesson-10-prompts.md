# 10차시: 텔레그램 알림 봇 설계 및 검토

## 1번 프롬프트

```text
자동매매 시스템을 위한 텔레그램 알림 봇을 설계해줘.
```

### 프롬프트 분석 및 설계

- **목표**: 거래 이벤트/상태/오류를 안전·신뢰성 있게 전달하고 운영 커맨드를 지원
- **아키텍처**: Producer → Router/Dedup/RateLimit/Formatter/Sender → Telegram; Command Handler
- **정책**: 긴급(P0) 즉시, 중요(P1) 집계(30s), 일반(P2) 배치(5~10m), 디버그(P3) 기본 비활성
- **신뢰성**: 재시도(백오프+지터), 서킷브레이커, Outbox(미전송 보관), 중복 억제(해시 30s)
- **보안**: 토큰 보호, 채팅 화이트리스트, 역할(읽기/운영/관리), 감사 로그
- **명령어**: /start_trading, /stop_trading, /status, /positions, /pnl, /reload_config, /health

## 2번 프롬프트

```text
위에서 제안한 텔레그램 봇 설계를 검토해줘.
검토 포인트:
1. 사용자 경험의 직관성
2. 알림의 적시성과 정확성
3. 시스템 안정성
4. 확장 가능성
5. 보안성
```

### 프롬프트 분석 및 검토

- **사용자 경험의 직관성**: 간단한 명령어 세트, 일관된 템플릿, 스레드(주제별) 분리 제안
- **알림의 적시성/정확성**: P0 즉시 우회큐, 타임스탬프/상관ID 포함, 클록 동기화(KST)
- **시스템 안정성**: RateLimit(채널별 토큰버킷), 서킷 오픈 시 배치 보관, 재가동시 Outbox 재전송
- **확장 가능성**: 이벤트 스키마 표준화, 라우팅 룰/템플릿 구성파일화, 멀티 채널(그룹/DM) 지원
- **보안성**: 사용자/역할 매핑, 명령 서명(옵션), 민감정보 마스킹, 권한오류 로깅/알림

## 3번 프롬프트

```text
텔레그램 봇의 기본 구조를 설계해줘.
주요 기능:
- 봇 초기화 및 설정
- 메시지 수신 및 처리
- 명령어 파싱
- 응답 메시지 생성
- 알림 전송
Python telegram-bot 라이브러리를 사용하여 확장 가능하고 유지보수가 쉬운 구조로 설계해줘.
```

### 프롬프트 분석 및 설계

- **구성요소**: BotInitializer(토큰/설정/웹훅), UpdateHandler(메시지/콜백 처리), CommandParser(명령 파싱/권한), ResponseBuilder(템플릿/포맷), Notifier(알림 전송)
- **수신 방식**: Long-polling(개발/소규모) 또는 Webhook(운영/저지연) 선택 가능
- **설정 관리**: YAML/ENV 기반 설정, 핫리로드 옵션, 채널/권한/레이트리밋 구성
- **에러 처리**: 예외 분류(입력/권한/시스템), 재시도 정책, 사용자 친화적 에러 응답
- **레이트리밋**: 사용자/채팅 단위 토큰버킷, 명령 스팸 방지 쿨다운
- **로깅/모니터링**: 구조화 로그, 명령 성공률/지연/오류율 메트릭
- **테스트**: 명령 파서/핸들러 단위테스트, Webhook 엔드포인트 통합테스트

## 4번 프롬프트

```text
위에서 설계한 텔레그램 봇의 기본 구조를 구현해줘
구현 요구사항:
1. 봇 초기화 및 설정 로드
2. 기본 명령어 처리 (/start, /help, /status)
3. 메시지 포맷팅 및 전송
4. 오류 처리 및 로깅
5. 설정 파일 관리

각 기능이 독립적으로 동작하고, 확장 가능한 구조로 구현해줘.
```

### 프롬프트 분석 및 구현

- **모듈 분리**: config 로더, bot 초기화, command 핸들러, formatter, notifier, logger 분리
- **확장성**: 핸들러/포맷터 플러그인 패턴, 설정 기반 라우팅/권한
- **안정성**: 예외 공통 처리, 재시도 정책(전송부), 구조화 로깅
- **유지보수**: 타입힌트/도큐스트링/테스트 포인트 마련

## 5번 프롬프트

```text
기본 텔레그램 봇에 자동매매 관련 기능을 추가해줘.
추가할 기능:
1. 거래 내역 조회 (/trades)
2. 수익률 확인 (/profit)
3. 시스템 상태 확인 (/status)
4. 설정 변경 (/settings)
5. 거래 중지/시작 (/stop, /start)
각 명령어에 대한 상세한 응답과 사용자 친화적인 인터페이스를 구현해줘.
```

### 프롬프트 분석 및 구현

- **도메인 핸들러**: TradingHandler(거래내역/수익률), SystemHandler(상태/설정), ControlHandler(시작/중지)
- **데이터 연동**: DB/API 클라이언트 주입, 실시간 데이터 조회, 캐싱 전략
- **UI/UX**: 인라인 키보드, 페이지네이션, 진행률 표시, 에러 상태 안내
- **권한/검증**: 명령별 권한 체크, 입력 파라미터 검증, 사용자별 접근 제어
- **성능**: 비동기 처리, 응답 시간 최적화, 대용량 데이터 스트리밍

## 6번 프롬프트

```text
자동매매 시스템을 위한 알림 로직을 설계해줘.
알림 시나리오:
1. 거래 실행 시 (매수/매도)
2. 수익률 달성 시
3. 손실 한계 도달 시
4. 시스템 오류 발생 시
5. 정기 상태 보고
알림 요구사항:
- 즉시 전송
- 적절한 우선순위
- 중복 알림 방지
- 사용자 설정 반영
- 알림 히스토리 관리
각 시나리오별로 최적화된 알림 로직을 설계하고, 사용자 경험을 고려한 메시지 포맷을 제안해줘.
```

### 프롬프트 분석 및 설계

- **알림 엔진**: EventRouter(시나리오별 라우팅), PriorityQueue(우선순위 처리), Deduplicator(중복 억제), TemplateEngine(메시지 포맷)
- **시나리오별 로직**: 거래실행(즉시), 수익률(임계값 기반), 손실한계(긴급), 시스템오류(즉시+집계), 정기보고(스케줄)
- **사용자 설정**: 알림 활성화/비활성화, 채널별 설정, 임계값 커스터마이징, 집계 주기 조정
- **메시지 포맷**: 이모지/색상 구분, 핵심 정보 강조, 액션 버튼, 링크/차트 포함
- **히스토리 관리**: 알림 로그 저장, 검색/필터링, 통계 분석, 보관 정책

## 7번 프롬프트

```text
위에서 설계한 알림 로직을 구현해줘.
구현 요구사항:
1. 알림 큐 시스템
2. 우선순위 기반 알림 처리
3. 중복 알림 필터링
4. 사용자 설정 관리
5. 알림 히스토리 저장
알림이 적시에 정확하게 전송되도록 하고,
사용자가 원하지 않는 알림을 제어할 수 있도록 구현해줘
```

### 프롬프트 분석 및 구현

- **컴포넌트**: NotificationQueue(우선순위 큐), Notifier(전송/재시도), Deduplicator(키 기반 억제), UserPrefs(설정), HistoryStore(로그/검색)
- **정확성**: 타임스탬프/상관ID 포함, 순서 보전(카테고리 내), 재전송 보호
- **제어성**: 사용자/채널별 온오프/임계값/집계 정책 적용, 사전 검증
- **성능**: 비동기 워커/버스트 제어, 배치 전송(비긴급), 백프레셔