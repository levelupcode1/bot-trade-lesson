# 실시간 적응형 자동매매 봇 사용 가이드

## 🚀 빠른 시작

### 1. 패키지 설치

```bash
cd lesson-17
pip install -r requirements.txt
```

필요한 패키지:
- `pandas`: 데이터 처리
- `numpy`: 수치 계산
- `requests`: API 통신

### 2. 실행

```bash
python realtime_adaptive_bot.py
```

### 3. 설정

실행 시 다음을 설정합니다:

1. **거래할 코인 선택**
   - KRW-BTC (비트코인)
   - KRW-ETH (이더리움)
   - KRW-XRP (리플)
   - 직접 입력

2. **초기 자금** (기본값: 1,000,000원)
   - 시뮬레이션용 가상 자금

3. **업데이트 간격** (기본값: 300초 = 5분)
   - 시장 분석 주기

## 📊 봇 작동 방식

### 한 사이클 실행 순서

```
1. 데이터 수집
   └─ 업비트 API에서 실시간 가격 조회
   └─ 최근 100일 일봉 데이터 조회

2. 시장 상황 분석
   └─ 추세 분석 (이동평균, 고점/저점)
   └─ 변동성 분석 (ATR, 볼린저 밴드)
   └─ 모멘텀 분석 (RSI, MACD)
   └─ 거래량 분석

3. 전략 선택
   └─ 시장 상황에 따라 최적 전략 자동 선택
   └─ 신뢰도 낮으면 현재 전략 유지

4. 신호 생성
   └─ 선택된 전략으로 매매 신호 생성
   └─ BUY / SELL / HOLD

5. 주문 실행 (DRY RUN)
   └─ 시뮬레이션으로 포지션 관리
   └─ 실제 주문은 실행 안 함

6. 성과 추적
   └─ 수익률 계산
   └─ 전략별 성과 분석
```

## 🎯 전략 자동 전환 예시

### 예시 1: 횡보 → 상승장 전환

```
[09:00] 횡보장 감지
└─ 전략: 레인지 트레이딩
└─ 신호: HOLD (RSI 중립)

[14:00] 상승 추세 전환 감지
└─ 전략: 레인지 → 추세 추종 (전환!)
└─ 신호: BUY (골든 크로스)
└─ 액션: 매수 포지션 진입

[16:00] 상승 추세 지속
└─ 전략: 추세 추종 유지
└─ 신호: HOLD (추세 유지 중)
└─ 포지션: 보유 중 (+3.5%)
```

### 예시 2: 하락장 전환

```
[10:00] 상승장
└─ 전략: 추세 추종
└─ 포지션: 보유 중 (+5.2%)

[13:00] 하락 추세 전환 감지
└─ 전략: 추세 추종 → 방어 전략 (전환!)
└─ 신호: SELL (데드 크로스)
└─ 액션: 포지션 청산 (+5.2% 익절)

[15:00] 하락장 지속
└─ 전략: 방어 전략 유지
└─ 신호: HOLD (현금 보유)
└─ 포지션: 없음 (안전)
```

## 📱 실시간 로그 예시

```
================================================================================
📊 업데이트 #15 - 2024-01-15 14:30:00
================================================================================

1️⃣ 데이터 수집 중...
현재가: 52,350,000원
24시간 변동: +3.25%
거래량: 12,543.25

2️⃣ 전략 분석 및 실행...

📈 시장 상황 분석:
  추세: 상승장
  추세 강도: 0.75
  변동성: 보통
  모멘텀: +0.45
  거래량: increasing
  신뢰도: 0.82
  → 추천 전략: trend_following

================================================================================
🔄 전략 전환
================================================================================
이전 전략: range_trading
새 전략: trend_following
시장 상황: 상승장
변동성: 보통
신뢰도: 0.82
================================================================================

🎯 신호 분석:
  현재 전략: trend_following
  신호: BUY
  신뢰도: 0.90
  사유: 골든 크로스 - 추세 전환 시그널

✅ 매수 신호 감지!
  [DRY RUN] 실제 주문은 실행하지 않습니다.

✅ 포지션 개설
전략: trend_following
진입가: 52,350,000원
투자금: 150,000원
손절가: 49,732,500원
익절가: 60,202,500원
사유: 골든 크로스 - 추세 전환 시그널

💰 계좌 상태:
  현재 잔고: 850,000원
  수익률: +0.00%
  총 거래: 5회
  승률: 60.0%
  승: 3회 | 패: 2회
  전략 전환: 3회
  현재 전략: trend_following
```

## ⚙️ 설정 커스터마이징

### 업데이트 간격 변경

```python
# 더 빠른 업데이트 (1분마다)
bot = RealtimeAdaptiveBot(
    market='KRW-BTC',
    initial_balance=1_000_000,
    update_interval=60  # 60초
)

# 느린 업데이트 (30분마다)
bot = RealtimeAdaptiveBot(
    market='KRW-BTC',
    initial_balance=1_000_000,
    update_interval=1800  # 1800초
)
```

### 전략 전환 신뢰도 조정

```python
# adaptive_strategy_system.py 수정
system = AdaptiveStrategySystem(
    account_balance=initial_balance,
    min_confidence=0.7  # 70% 이상에서만 전환 (더 보수적)
)
```

### 시장 감지 기준 조정

```python
# market_condition_detector.py 수정
detector = MarketConditionDetector()

# 추세 판단 기준 변경 (더 민감하게)
detector.trend_thresholds = {
    'strong_bull': 0.10,    # 10%로 하향 (더 빨리 감지)
    'bull': 0.03,           # 3%로 하향
    'sideways': 0.03,       # ±3%
    'bear': -0.03,
    'strong_bear': -0.10,
}
```

## 🛡️ 리스크 관리

### 자동 손절/익절

각 전략마다 자동 설정:

| 전략 | 손절 | 익절 |
|------|------|------|
| 추세 추종 | -5% | +15% |
| 레인지 | -2% | +5% |
| 변동성 돌파 | -4% | +10% |
| 스캘핑 | -2% | +3% |
| 방어 | -3% | +5% |

### 포지션 크기

- **보수적 전략**: 계좌의 1-2%
- **일반 전략**: 계좌의 2-3%
- **공격적 전략**: 계좌의 3-5%

### 안전 장치

1. **신뢰도 필터**: 신뢰도 60% 미만 시 거래 안 함
2. **전략 유지**: 신뢰도 낮으면 현재 전략 유지
3. **DRY RUN**: 기본적으로 시뮬레이션 모드

## 📊 성과 분석

### 실시간 모니터링

봇은 매 사이클마다 다음을 출력:
- 현재 시장 상황
- 전략 전환 이력
- 포지션 상태
- 계좌 잔고 및 수익률
- 전략별 성과

### 로그 파일

모든 활동은 로그 파일에 기록됩니다:
- `realtime_bot_KRW-BTC.log`
- 타임스탬프와 함께 상세 기록
- 오류 및 경고 포함

### 최종 리포트

봇 종료 시 전체 성과 리포트 출력:
- 전체 수익률
- 거래 횟수 및 승률
- 전략별 성과
- 전략 전환 히스토리

## ⚠️ 주의사항

### 1. API 제한

업비트 API는 **초당 10회 요청 제한**이 있습니다.
- 봇은 적절한 대기 시간 사용
- 업데이트 간격을 너무 짧게 설정하지 마세요

### 2. 네트워크 오류

인터넷 연결이 불안정하면:
- API 호출 실패 가능
- 자동으로 재시도하지만 데이터 누락 가능
- 안정적인 네트워크 환경 권장

### 3. 시뮬레이션 vs 실전

현재는 **DRY RUN (시뮬레이션)** 모드:
- 실제 주문 실행 안 함
- 슬리피지 미반영
- 수수료 미반영
- 실전 적용 시 추가 구현 필요

### 4. 백테스팅 필수

실제 자금 투입 전:
- 충분한 시뮬레이션 (최소 1개월)
- 다양한 시장 상황 테스트
- 리스크 관리 검증

## 🔧 문제 해결

### API 연결 오류

```
오류: 데이터 수집 실패
```

**해결책:**
1. 인터넷 연결 확인
2. 업비트 API 상태 확인
3. requests 패키지 설치 확인

### 전략이 전환되지 않음

```
신뢰도 낮음 (0.45) - 현재 전략 유지
```

**정상 동작:**
- 신뢰도가 낮으면 전략을 유지합니다
- 더 명확한 신호를 기다립니다

### 매수 신호가 없음

```
신호: HOLD
```

**원인:**
- 시장 상황이 불명확
- 신뢰도가 낮음
- 현재 전략에서 진입 조건 미충족

## 🎓 추가 학습

### 다음 단계

1. **실제 주문 API 연동**
   - 업비트 주문 API 구현
   - 체결 확인 로직 추가

2. **고급 리스크 관리**
   - 동적 손절/익절
   - 포트폴리오 리스크 관리
   - 상관관계 분석

3. **성과 최적화**
   - 전략 파라미터 최적화
   - 머신러닝 통합
   - 백테스트 엔진 구축

4. **모니터링 강화**
   - 텔레그램 알림 추가
   - 웹 대시보드 구축
   - 실시간 차트 표시

## 📞 지원

- 버그 리포트: GitHub Issues
- 질문: Discussions
- 기능 제안: Pull Request

---

**⚡ 시작하기**

```bash
python realtime_adaptive_bot.py
```

**행운을 빕니다! 🚀**

